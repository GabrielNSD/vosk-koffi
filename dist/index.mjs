import{fileURLToPath as u}from"url";import z from"path";var f=()=>u(import.meta.url),h=()=>z.dirname(f()),a=h();import k from"os";import n from"path";import _ from"koffi";_.opaque("VoskModel");_.opaque("VoskSpkModel");_.opaque("VoskRecognizer");var l;if(k.platform()=="win32"){let s=process.env.Path,e=n.resolve(n.join(a,"../lib","win-x86_64"));process.env.Path=e+n.delimiter+s,l=n.join(a,"../lib","win-x86_64","libvosk.dll")}else k.platform()=="darwin"?l=n.join(a,"../lib","osx-universal","libvosk.dylib"):l=n.join(a,"../lib","linux-x86_64","libvosk.so");var r=_.load(l),o={vosk_set_log_level:r.func("void vosk_set_log_level(int log_level)"),vosk_model_new:r.func("VoskModel *vosk_model_new(const char *model_path)"),vosk_model_free:r.func("void vosk_model_free(VoskModel *model)"),vosk_spk_model_new:r.func("VoskSpkModel *vosk_spk_model_new(const char *model_path)"),vosk_spk_model_free:r.func("void vosk_spk_model_free(VoskSpkModel *model)"),vosk_recognizer_new_spk:r.func("VoskRecognizer *vosk_recognizer_new_spk(VoskModel *model, float sample_rate, VoskSpkModel *spk_model)"),vosk_recognizer_new:r.func("VoskRecognizer *vosk_recognizer_new(VoskModel *model, float sample_rate)"),vosk_recognizer_new_grm:r.func("VoskRecognizer *vosk_recognizer_new_grm(VoskModel *model, float sample_rate, const char *grammar)"),vosk_recognizer_free:r.func("void vosk_recognizer_free(VoskRecognizer *recognizer)"),vosk_recognizer_set_max_alternatives:r.func("void vosk_recognizer_set_max_alternatives(VoskRecognizer *recognizer, int max_alternatives)"),vosk_recognizer_set_words:r.func("void vosk_recognizer_set_words(VoskRecognizer *recognizer, int words)"),vosk_recognizer_set_partial_words:r.func("void vosk_recognizer_set_partial_words(VoskRecognizer *recognizer, int partial_words)"),vosk_recognizer_set_spk_model:r.func("void vosk_recognizer_set_spk_model(VoskRecognizer *recognizer, VoskSpkModel *spk_model)"),vosk_recognizer_accept_waveform:r.func("int vosk_recognizer_accept_waveform(VoskRecognizer *recognizer, const char *data, int length)"),vosk_recognizer_result:r.func("const char *vosk_recognizer_result(VoskRecognizer *recognizer)"),vosk_recognizer_final_result:r.func("const char *vosk_recognizer_final_result(VoskRecognizer *recognizer)"),vosk_recognizer_partial_result:r.func("const char *vosk_recognizer_partial_result(VoskRecognizer *recognizer)"),vosk_recognizer_reset:r.func("void vosk_recognizer_reset(VoskRecognizer *recognizer)")};function P(s){o.vosk_set_log_level(s)}var g=class{constructor(e){this.handle=o.vosk_model_new(e)}free(){o.vosk_model_free(this.handle)}},d=class{constructor(e){this.handle=o.vosk_spk_model_new(e)}free(){o.vosk_spk_model_free(this.handle)}};function m(s,e){return s.hasOwnProperty(e)}var v=class{constructor(e){let{model:t,sampleRate:i}=e;if(m(e,"speakerModel")&&m(e,"grammar"))throw new Error("grammar and speakerModel cannot be used together for now.");this.handle=e.speakerModel?o.vosk_recognizer_new_spk(t.handle,i,e.speakerModel.handle):e.grammar?o.vosk_recognizer_new_grm(t.handle,i,JSON.stringify(e.grammar)):o.vosk_recognizer_new(t.handle,i)}free(){o.vosk_recognizer_free(this.handle)}setMaxAlternatives(e){o.vosk_recognizer_set_max_alternatives(this.handle,e)}setWords(e){o.vosk_recognizer_set_words(this.handle,Number(e))}setPartialWords(e){o.vosk_recognizer_set_partial_words(this.handle,Number(e))}setSpkModel(e){o.vosk_recognizer_set_spk_model(this.handle,e.handle)}acceptWaveform(e){return!!o.vosk_recognizer_accept_waveform(this.handle,e,e.length)}acceptWaveformAsync(e){return new Promise((t,i)=>{o.vosk_recognizer_accept_waveform.async(this.handle,e,e.length,function(c,p){c?i(c):t(!!p)})})}resultString(){return o.vosk_recognizer_result(this.handle)}result(){return JSON.parse(o.vosk_recognizer_result(this.handle))}partialResult(){return JSON.parse(o.vosk_recognizer_partial_result(this.handle))}finalResult(){return JSON.parse(o.vosk_recognizer_final_result(this.handle))}reset(){o.vosk_recognizer_reset(this.handle)}};export{g as Model,v as Recognizer,d as SpeakerModel,P as setLogLevel};
